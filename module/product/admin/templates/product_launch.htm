<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>产品发布</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="admin.css" rel="stylesheet" type="text/css" />
<script src="<{$config.weburl}>/script/jquery-1.4.4.min.js" type="text/javascript" charset="utf-8" ></script>
<script src="<{$config.weburl}>/script/my_lightbox.js" type="text/javascript" charset="utf-8"></script>
<script src="<{$config.weburl}>/script/district.js" type="text/javascript" charset="utf-8"></script>
<script language="javascript">
var weburl="<{$config.weburl}>";
</script>
</head>
<body>
<div class="container">
<div class="flow">
    <div class="itemtitle">
        <h3>产品详情</h3>
        <ul>
            <li class="current"><a id="base" href="javascript:;"><span>基本信息</span></a></li>
            <{if $firstvalue.d.0}><li><a id="spec" href="javascript:;"><span>规格</span></a></li><{/if}>
            <{if $firstvalue.s.0}><li><a id="other" href="javascript:;"><span>其它属性</span></a></li><{/if}>
            <{if $firstvalue.p}><li><a id="parameter" href="javascript:;"><span>详细参数</span></a></li><{/if}>
            <{if $service}><li><a id="service" href="javascript:;"><span>产品服务</span></a></li><{/if}>
            <li><a id="detail" href="javascript:;"><span>详细介绍</span></a></li>
            <li><a id="customer" href="javascript:;"><span>售后服务</span></a></li>
            <li><a id="logistics" href="javascript:;"><span>物流信息</span></a></li>
            <li><a id="parts" href="javascript:;"><span>配件</span></a></li>
            <li><a id="give" href="javascript:;"><span>赠送产品</span></a></li>
            <li><a id="related" href="javascript:;"><span>相关产品</span></a></li>
        </ul>
    </div>
</div>
<div class="h35"></div>
<form method="post" action="" enctype="multipart/form-data">
    <table class="table" id="base">
    <thead>
    <tr>
        <th colspan="2" class="partition">基本信息</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td width="100">所属分类</td>
        <td>
        <{$typenames}>
        <{if !$smarty.get.catid}>
        <input name="catid" id="catid" type="hidden" value="<{$de.catid}>" />
        <input name="tcatid" id="tcatid" type="hidden" value="<{$de.tcatid}>" />
        <input name="scatid" id="scatid" type="hidden" value="<{$de.scatid}>" />
        <input name="sscatid" id="sscatid" type="hidden" value="<{$de.sscatid}>" />
        <a href="module.php?m=product&s=product_launch.php&editid=<{$smarty.get.edit}>&cat=<{$de.catid}>&tcatid=<{$de.tcatid}>&scatid=<{$de.scatid}>&sscatid=<{$de.sscatid}>">编辑</a>
        <{else}>
        <input name="catid" id="catid" type="hidden" value="<{$smarty.get.catid}>" />
        <input name="tcatid" id="tcatid" type="hidden" value="<{$smarty.get.tcatid}>" />
        <input name="scatid" id="scatid" type="hidden" value="<{$smarty.get.scatid}>" />
        <input name="sscatid" id="sscatid" type="hidden" value="<{$smarty.get.sscatid}>" />
        <a href="module.php?m=product&s=product_launch.php&editid=<{$smarty.get.edit}>&cat=<{$smarty.get.catid}>&tcatid=<{$smarty.get.tcatid}>&scatid=<{$smarty.get.scatid}>&sscatid=<{$smarty.get.sscatid}>">编辑</a>
        <{/if}>
        </td>
    </tr>
    
    <tr>
      <td>产品名称</td>
      <td><input maxlength="100" name="title" type="text" id="title" class="w350" value="<{$de.pname}>" /></td>
    </tr>
    
    <tr>
      <td>副标题</td>
      <td><input name="ftitle" type="text" id="ftitle" class="w350" value="<{$de.ftitle}>" /></td>
    </tr>
    
    
    <tr>
      <td>促销提示</td>
      <td><input name="promotion_tips" type="text" id="promotion_tips" class="w350" value="<{$de.promotion_tips}>" /></td>
    </tr>
    
    <tr>
        <td>产品编号</td>
        <td><input value="<{if $de.code}><{$de.code}><{else}>1<{/if}>" name="code" type="text" class="w350" /></td>
    </tr>
    
    <tr>
        <td><{$lang.keyword}></td>
        <td><input name="keywords" type="text" value="<{$de.keywords}>" class="w350" /></td>
    </tr>
    
    <tr>
        <td>品牌</td>
        <td><{$brand}></td>
    </tr>
    
    <tr>
        <td>销售价</td>
        <td><input type="text" name="price" id="price" maxlength="10" value="<{if $de.price}><{$de.price}><{else}>1.00<{/if}>" /></td>
    </tr>
    
    <tr>
        <td>上传图片</td>
        <td>
            <div class="product_image">
                <ul id="list1">
                    <{foreach item=list key=key from=$de.pic}>
                        <li id="p<{$key+1}>" data-itemid='<{$key+1}>'>
                            <div class="product_image_list"> 
                                <div data_type="handle_image">
                                    <div class="image">
                                    <input name="pic[]" type="hidden" id="img<{$key}>" value="<{$list}>" />
                                    <{if $list}>
                                    <img id="img<{$key}>_img" src="<{$list}>" width="60">
                                    <{else}>
                                    <img width="60" id="img<{$key}>_img" src="<{$config.weburl}>/image/default/nopicsmall.gif"  />
                                    <{/if}>
                                    </div>
                                    <div data_type="handle" class="bg">
                                    <span title="删除" data_type="delete_image">删除</span>
                                    </div>
                                </div>
                                <div class="upload-btn"><a class="upload-button" href="javascript:uploadfile('Style images','img<{$key}>',300,300,'product')">上传</a></div>
                            </div>
                        </li>
                    <{/foreach}>
                    <{assign var=count value=$de.pic|@count}>
                    <{section name=name loop=$count*-1+5}>
                        <li id="p<{$key+$smarty.section.name.index+1}>" data-itemid='<{$key+$smarty.section.name.index+1}>'>
                            <div data_type="handle_image">
                                <div class="image">
                                    <input name="pic[]" type="hidden" id="pic<{$smarty.section.name.index}>" value="" />
                                    <img width="60" id="pic<{$smarty.section.name.index}>_img" src="<{$config.weburl}>/image/default/nopicsmall.gif"  />
                                </div>
                                <div data_type="handle" class="bg">
                                <span title="删除" data_type="delete_image" class="delete">删除</span>
                                </div>
                            </div>
                            <div class="upload-btn"><a class="upload-button" href="javascript:uploadfile('Style images','pic<{$smarty.section.name.index}>',300,300,'product')">上传</a></div>
                        </li>
                    <{/section}>
                </ul>
            </div>
        </td>
    </tr>
    
    <tr>
        <td>市场价</td>
        <td><input type="text" name="market_price" id="market_price" maxlength="10" value="<{if $de.market_price}><{$de.market_price}><{else}>0.00<{/if}>" /></td>
    </tr>
    
    <tr>
        <td>成本价</td>
        <td><input type="text" name="cost_price" id="cost_price" maxlength="10" value="<{if $de.cost_price}><{$de.cost_price}><{else}>0.00<{/if}>" /></td>
    </tr>
    
    <tr>
        <td>开启会员价</td>
        <td><input type="checkbox" <{if $de.member_price==1}>checked="checked"<{/if}> value="1" name="member_price" /></td>
    </tr>
    
    <tr>
        <td>标签</td>
        <td>
        <{foreach item=list key=num from=$tag}>
        <input <{if @$list.id|in_array:$de.statu }>checked="checked"<{/if}> id="statu<{$num}>" name="statu[]" type="checkbox" value="<{$list.id}>" /><label for="statu<{$num}>"><{$list.name}></label>
        <{/foreach}>
        </td>
    </tr>
    
    <tr>
        <td>库存</td>
        <td><input id="amount" name="amount" type="text" value="<{if $de.amount}><{$de.amount}><{else}>1<{/if}>"/></td>
    </tr>
    
    <tr>
        <td>积分</td>
        <td><input id="point" name="point" type="text" value="<{if $de.point}><{$de.point}><{else}>0<{/if}>"/></td>
    </tr>
    
    <tr>
        <td colspan="99" class="height"></td>
    </tr>
    </tbody>
    </table>
    
    <{if $firstvalue.d.0}>
    <table class="table"  id="spec">
    <thead>
    <tr>
        <th colspan="2" class="partition">规格</th>
    </tr>
    </thead>
    
    <tbody class="firstvalue">
    <{foreach item=list key=num from=$firstvalue.d}>
    <tr>
        <td><{$list.name}></td>
        <td data_type="property_td_<{$num}>" class="property">
            <ul class="property_ul" <{if $list.field=='color'}>id="color"<{/if}>>
                <{$list.item}>
            </ul>
            <div class="clear"></div>
            <{if $list.field=='color'}>
                <table cellpadding="0" cellspacing="0" data_type="color_img" style="display:none">
                    <thead>
                    <tr>
                        <td>颜色</td>
                        <td width="400">图片（无图片可不填）</td>
                        <td width="100">已有图片</td>
                    </tr>
                    </thead>
                    <tbody>
                    <{foreach item=list key=key from=$firstvalue.d}>
                    <{if $list.field=='color'}>
                    <{foreach item=slist key=num from=$list.color}>
                        <tr id="color_img_tr_<{$num}>" style="display:none">
                            <td><{$slist.name}></td>
                            <td>
                            <input name="color_img[<{$key}>_<{$num}>]" type="text" id="color_img<{$num}>" class="w250" value="<{$slist.img}>" /> 
                            <a class="upload-button" href="javascript:uploadfile('Style images','color_img<{$num}>',310,310,'product');">上传</a>
                            
                            <img align="absmiddle" id="color_img<{$num}>_img" class="imgs" src="../image/default/user_admin/transparent.gif" />
                            </td>
                            <td><{if !$slist.img}>当前无图片<{else}><img align="absmiddle" class="imgs" src="<{$slist.img}>" /><{/if}></td>
                        </tr>
                    <{/foreach}>
                    <{/if}>
                    <{/foreach}>
                    </tbody>
                </table>
            <{/if}>
        </td>
    </tr>
    <{/foreach}>
    </tbody>
    
    <tbody data_type="property_tbody" style="display:none">
    <tr>
        <td>库存配置</td>
        <td class="property">
            <div>
            <table>
                <thead>
                <tr>
                    <{foreach item=list key=num from=$firstvalue.d}>
                    <td><{$list.name}></td>
                    <{/foreach}>
                    <td>销售价</td>
                    <td>市场价</td>
                    <td>成本价</td>
                    <td>库存</td>
                    <td>产品货号</td>
                </tr> 
                </thead>
                <tbody data_type="property_table"></tbody>
            </table>
            </div>
        </td>
    </tr>        
    </tbody>
    </table>
    <{/if}>
    
    <{if $firstvalue.s.0}>
    <table class="table" id="other">
    <thead>
    <tr>
        <th colspan="2" class="partition">其它属性</th>
    </tr>
    </thead>
    
    <tbody>
    <{foreach item=list key=num from=$firstvalue.s}>
        <{$list}>
    <{/foreach}>
    <tr>
        <td colspan="99" class="height"></td>
    </tr>
    </tbody>   
    </table>
    <{/if}>
    
    <{if $firstvalue.p}>
    <table class="table" id="parameter">
    <thead>
    <tr>
        <th colspan="2" class="partition">详细参数</th>
    </tr>
    </thead>
    
    <tbody>
    <{foreach item=list key=num from=$firstvalue.p}>
        <tr><td width="100"><{$num}></td></tr>
        <{foreach item=slist key=key from=$list}>
            <{$slist}>
        <{/foreach}>
    <{/foreach}>
    <tr>
        <td colspan="99" class="height"></td>
    </tr>
    </tbody>   
    </table>
    <{/if}>
    
    <{if $service}>
    <table class="table" id="service">
    <thead>
    <tr>
        <th colspan="2" class="partition">产品服务</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td width="100">产品服务</td>
        <td>
        <{foreach  item=list key=num from=$service}>
        <input <{if @$list.id|in_array:$de.services}>checked="checked"<{/if}> type="checkbox" name="service[]" id="service<{$list.id}>" value="<{$list.id}>" />
        <label for="service<{$list.id}>"><{$list.name}></label>
        <{/foreach}>
        </td>
    <tr>
        <td colspan="99" class="height"></td>
    </tr>
    </tbody>
    </table>
    <{/if}>
    
    <table class="table" id="detail">
    <thead>
    <tr>
        <th colspan="2" class="partition">详细介绍</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td colspan="2" class="detail">
        <script charset="utf-8" src="<{$config.weburl}>/lib/kindeditor/kindeditor-min.js"></script>
        <script>
            var editor;
            KindEditor.ready(function(K) {
                editor = K.create('textarea[name="detail"]', {});
        });
        </script>
        <textarea name="detail" id="detail" style="width:100%; height:400px;"><{$de.detail}></textarea>
        </td>
    </tr>
    </tbody>
    </table>
    <table class="table" id="customer">
    <thead>
    <tr>
        <th colspan="2" class="partition">售后服务</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td colspan="2" class="detail">
        <script charset="utf-8" src="<{$config.weburl}>/lib/kindeditor/kindeditor-min.js"></script>
        <script>
            var editor;
            KindEditor.ready(function(K) {
                editor = K.create('textarea[name="after_service"]', {
            });
        });
        </script>
        <textarea name="after_service" id="after_service" style="width:100%; height:400px;"><{$de.after_service}></textarea>
        </td>
    </tr>
    </tbody>
    </table>
    <table class="table" id="logistics">
    <thead>
    <tr>
        <th colspan="2" class="partition">物流信息</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td width="100">所在地址</td>
        <td>
            <input type="hidden" name="t" id="t" value="<{$de.area}>" />
            <input type="hidden" name="province" id="id_1" value="<{$de.province}>" />
            <input type="hidden" name="city" id="id_2" value="<{$de.city}>" />
            <input type="hidden" name="area" id="id_3" value="<{$de.areaid}>" />
            <{if $de.area}>
            <div id="d_1"><{$de.area}>&nbsp;&nbsp;<a href="javascript:sd();">编辑</a></div>
            <{/if}>
            <div id="d_2" <{if $de.area}>class="hidden"<{/if}>>
                <select id="select_1" onChange="selClass(this);">
                <option value="">--请选择--</option>
                <{$prov}>
                </select>
                <select id="select_2" onChange="selClass(this);" class="hidden"></select>
                <select id="select_3" onChange="selClass(this);" class="hidden"></select>
            </div>
        </td>
    </tr>
    
    <tr>
        <td>物流体积(立方米)</td>
        <td><input value="<{if $de.weight}><{$de.weight}><{else}>0<{/if}>" name="weight" type="text" /></td>
    </tr>
    
    <tr>
        <td>物流重量(千克)</td>
        <td><input value="<{if $de.cubage}><{$de.cubage}><{else}>0<{/if}>" name="cubage" type="text" /></td>
    </tr>
    
    <tr>
        <td colspan="99" class="height"></td>
    </tr>
    </tbody>
    </table>
    <table class="table" id="parts">
    <thead>
    <tr>
        <th colspan="2" class="partition">配件</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td colspan="99" class="colspan">
            <table width="100%" class="alc">
               	<tr id="parts_tr" <{if !$de.product_partss}> style="display:none"<{/if}>>
                    <th class="al">产品名称</th>
                    <th width="100">产品编号</th>
                    <th width="100">销售价</th>
                    <th width="100">市场价</th>
                    <th width="100">成本价</th>
                    <th width="100">库存</th>
                    <th width="100"></th>
                </tr>
                <{foreach item=slist from=$de.product_partss}>
                <{foreach item=list from=$slist}>
                <tr>
                    <td class="al"><{$list.pname}></td>
                    <td><{$list.code}></td>
                    <td><{$list.price}></td>
                    <td><{$list.market_price}></td>
                    <td><{$list.cost_price}></td>
                    <td><{$list.amount}></td>
                    <td><div><a href="javascript:;" class="deleterow" onClick="deleterow(this,<{$list.id}>,'related')">删除</a></div></td>
                </tr>
                <{/foreach}>
                <{/foreach}>
                <tr>
                    <td colspan="99" class="al">
                        <a class="addtr" id="parts_button" data_type="parts" href="javascript:void();">添加配件</a>
						<input type="hidden" id="hidden_parts" name="product_parts" value="<{if $de.product_parts}><{$de.product_parts}>,<{else}>0,<{/if}>" />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
    </table>
    <table class="table" id="give">
    <thead>
    <tr>
        <th colspan="2" class="partition">赠送产品</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td colspan="99" class="colspan">
            <table width="100%" class="alc">
               <tr id="give_tr" <{if !$de.product_gives}> style="display:none"<{/if}>>
                    <th class="al">产品名称</th>
                    <th width="100">产品编号</th>
                    <th width="100">销售价</th>
                    <th width="100">市场价</th>
                    <th width="100">成本价</th>
                    <th width="100">库存</th>
                    <th width="100"></th>
                </tr>
                <{foreach item=slist from=$de.product_gives}>
                <{foreach item=list from=$slist}>
                <tr>
                    <td class="al"><{$list.pname}></td>
                    <td><{$list.code}></td>
                    <td><{$list.price}></td>
                    <td><{$list.market_price}></td>
                    <td><{$list.cost_price}></td>
                    <td><{$list.amount}></td>
                    <td><div><a href="javascript:;" class="deleterow" onClick="deleterow(this,<{$list.id}>,'related')">删除</a></div></td>
                </tr>
                <{/foreach}>
                <{/foreach}>
                <tr>
                    <td colspan="99" class="al">
                    <a class="addtr" id="give_button" data_type="give" href="javascript:void();">赠送产品</a>
                       <input type="hidden" id="hidden_give" name="product_give" value="<{if $de.product_give}><{$de.product_give}>,<{else}>0,<{/if}>" />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
    </table>
    <table class="table" id="related">
    <thead>
    <tr>
        <th colspan="2" class="partition">相关产品</th>
    </tr>
    </thead>
    
    <tbody>
    <tr>
        <td colspan="99" class="colspan">
            <table width="100%" class="alc">
                <tr id="related_tr" <{if !$de.product_relateds}> style="display:none"<{/if}>>
                    <th class="al">产品名称</th>
                    <th width="100">产品编号</th>
                    <th width="100">销售价</th>
                    <th width="100">市场价</th>
                    <th width="100">成本价</th>
                    <th width="100">库存</th>
                    <th width="100"></th>
                </tr>
                <{foreach item=slist from=$de.product_relateds}>
                <{foreach item=list from=$slist}>
                <tr>
                    <td class="al"><{$list.pname}></td>
                    <td><{$list.code}></td>
                    <td><{$list.price}></td>
                    <td><{$list.market_price}></td>
                    <td><{$list.cost_price}></td>
                    <td><{$list.amount}></td>
                    <td><div><a href="javascript:;" class="deleterow" onClick="deleterow(this,<{$list.id}>,'related')">删除</a></div></td>
                </tr>
                <{/foreach}>
                <{/foreach}>
                <tr>
                    <td colspan="99" class="al">
                    <a class="addtr" id="related_button" data_type="related" href="javascript:void();">相关产品</a>
                    <input type="hidden" id="hidden_related" name="product_related" value="<{if $de.product_related}><{$de.product_related}>,<{else}>0,<{/if}>" />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
    </table>    
    <table>
    <tr>
        <td colspan="2" style="border-top:1px dotted #DEEFFB;">
            <input type="submit" value="<{$lang.submit}>" class="submit" onClick="return check_value();"/>
            <input name="submit" type="hidden" value="<{if $de.id}>edit<{else}>submit<{/if}>" />
            <input name="editID" type="hidden" id="editID" value="<{$de.id}>" />
            <input type="hidden" name="freightcon" value="0" />
            <input type="hidden" name="custom_cat" value="0" />
            <input type="hidden" name="rec_pro" value="0" />
            <input type="hidden" name="ptype" value="0" />
        </td>
    </tr>
    </table>
</form>
</div>
</body>
</html>
<script language="javascript" src="<{$config.weburl}>/script/product.js"></script>
<script language="javascript" src="<{$config.weburl}>/script/jquery.dragsort-0.5.1.min.js"></script>
<script type="text/javascript">

$('.addtr').unbind().each(function(){
	$(this).click(function(){
	type=$(this).attr('data_type');
	if(type=='parts') title="选择添加配件";
	if(type=='give') title="选择赠送产品";
	if(type=='related') title="选择相关产品";
	window.parent.iframe_form(type,title,'<{$config.weburl}>/admin/module.php?m=product&s=product_list.php&id=<{$de.id}>&catid=<{if $smarty.get.catid}><{$smarty.get.catid}><{else}><{$de.catid}><{/if}>&type='+type, 800, 505);
	return false;
	});
});

$('.itemtitle ul li').unbind().each(function(){
	$(this).click(function(){
		id=$(this).children().attr('id');
		$(this).addClass("current").siblings().removeClass("current");	
		if(id=='base')
			$(".container").find("table").removeClass("hidden");
		else
			$(".container").find("#"+id).removeClass("hidden").siblings(".table").addClass("hidden");	
	});
});

var rowtypedata = [
	[
		[1, '', 'al'], 
		[1, ''], 
		[1, ''], 
		[1, ''], 
		[1, ''],
		[1, ''],
		[1, '<div><a href="javascript:;" class="deleterow" onClick="deleterow(this,{1})">删除</a></div>'],
	
	],
];
var addrowdirect = 0;
var addrowkey = 0;
function addrow(name, type) {
	
	$('#'+name+'_tr').show();
	var obj=$('#'+name+'_button')[0];	
	var table = obj.parentNode.parentNode.parentNode.parentNode;
	var iframe=window.parent.document.getElementById("iframe_"+name).contentWindow;
	var tab=iframe.document.getElementById(name+"_table");
	var checkbox= $(tab).find("input[class='checkitem']:checked");
	var typedata = rowtypedata[type];
	$.each(checkbox,function(i){
		var value1=$("#hidden_"+name).val();
		var value2=this.value
		if(value1.indexOf(','+value2+',') <= 0 )
		{
			$("#hidden_"+name).val(value1+value2+',');	
			var tr=$(this).parent().parent();
			if(!addrowdirect) {
				var row = table.insertRow(obj.parentNode.parentNode.rowIndex);
			} else {
				var row = table.insertRow(obj.parentNode.parentNode.rowIndex + 1);
			}
			for(var i = 0; i <= typedata.length - 1; i++) {
				if(i<=6)
				{
					var cell = row.insertCell(i);
					if(i==6)
					{
						var tmp = typedata[i][1];
					}
					else
					{
						var tmp = tr.find('td')[i+1].innerHTML;
					}
					if(i==0){
						cell.className = typedata[i][2];
					}
					tmp = tmp.replace(/\{(n)\}/g, function($1) {return addrowkey;});
					tmp = tmp.replace(/\{(\d+)\}/g, function($1, $2) { return value2+',\''+name+'\''; });
					cell.innerHTML = tmp;
				}
			}
			addrowkey ++;
			addrowdirect =0;
		}
	});
}

function deleterow(obj,id,name) {
	var table = obj.parentNode.parentNode.parentNode.parentNode.parentNode;
	var tr = obj.parentNode.parentNode.parentNode;
	var value=$("#hidden_"+name).val();

	var pattern = ','+id+',';
	str = value.replace(new RegExp(pattern), ",");
	$("#hidden_"+name).val(str);
	table.deleteRow(tr.rowIndex);
}

$("#list1").dragsort({ dragSelector: "div", dragSelectorExclude:"span,a",dragBetween: true, dragEnd: saveOrder, placeHolderTemplate: "<li class='placeHolder'><div></div></li>" });

function saveOrder()
{
	var data = $("#list1 li").map(function() { return $(this).data("itemid"); }).get();
};

function check_value()
{
	
	if(!$('#img0').val())
	{
		if($('#pic0').val()=='')
		{
			alert('请上传图片');
			document.getElementById('pic0').focus();
			return false;
		}
	}
	if(!document.getElementById('title').value)
	{
		alert('<{$lang.notice_title}>');
		document.getElementById('title').focus();
		return false;
	}
	if(document.getElementById('catid').value=='')
	{
		alert('<{$lang.product_category}>');
		return false;
	}
	if(document.getElementById('price').value)
	{
		var str = document.getElementById('price').value;
		if(str.length>10||!str.match(/^(:?(:?\d+.\d+)|(:?\d+))$/))
		{
			alert('产品价格错误');
			document.getElementById('price').focus();
			return false;
		}
	}
	else
	{	
		if($('#tr2').css('display') != 'none')
		{
			alert('请填写产品价格');
			document.getElementById('price').focus();
			return false;
		}
	}
	
	if($('#amount').val()=='')
	{
		alert('请填写库存数量');
		document.getElementById('amount').focus();
		return false;
	}
	
	if($('#id_1').val()=='')
	{
		alert('请选择产品所在区域');
		return false;
	}
}
function load_pic()
{
	$.getScript("<{$config.weburl}>/script/product.js");	
}

/*-------------规格------------------*/
var property_checked = [<{foreach item=list key=num from=$firstvalue.d}><{if $num+1==$firstvalue.d|@count}>''<{else}>'',<{/if}><{/foreach}>];
var str = '';
var V = new Array();
<{foreach item=list key=num from=$firstvalue.d}>
var property_checked_<{$num}> = new Array();
<{/foreach}>

$(function(){
	$('tbody[data_type="property_table"]').find('input[type="text"]').live('change',function(){
		s = $(this).attr('data_type');
		V[s] = $(this).val();
	});
	
	$('span[data_type="chk"] > input[type="checkbox"]').click(function(){

		var span = $(this).parents('li').find('span[data_type="name"]');
		if(typeof(span.find('input').val()) == 'undefined'){
			span.html('<input type="text" maxlength="20" value="'+span.html()+'" />');
		}else{
			span.html(span.find('input').val());
		}	
		into_set();
		stock_set();
	});
	
	$('span[data_type="name"] > input').live('change',function(){
		change_name($(this));
		into_set();
		stock_set();
	});
	
	/*$('span[data_type="chk"] > input[type="checkbox"]').click(function(){
		into_set();
	});
	$('span[data_type="chk"] > input[type="checkbox"]').click(function(){
		stock_set();
	});*/
	
	$('input[data_type="stock"]').live('change',function(){
		count_stock();
	});
	$('input[data_type="sku"]').live('change',function(){
		code();
	});
	$('input[data_type="price"]').live('change',function(){
		count_price('price');
	});
	$('input[data_type="market_price"]').live('change',function(){
		count_price('market_price');
	});
	$('input[data_type="cost_price"]').live('change',function(){
		count_price('cost_price');
	});
	$('#color').find('input[type="checkbox"]').click(function(){
		pic_show($(this));
	});
	
	$('input[type="submit"]').click(function(){
		$('input[data_type="price"]').each(function(){
			if($(this).val() == ''){
				$(this).val($('input[name="price"]').val());
			}
		});
		$('input[data_type="stock"]').each(function(){
			if($(this).val() == ''){
				$(this).val('0');
			}
		});
		if($('dl[data_type="property_tbody"]').css('display') == 'none'){
			$('dl[data_type="property_tbody"]').find('input').attr('disabled','disabled');
		}
	});
	
});

function change_name(Obj){
	var checkbox = Obj.parents('li').find('input[type="checkbox"]');
	var id=Obj.parent().parent().parent().attr('id');
	checkbox.attr('data_type', Obj.val());
	if(id=='color')
	{
		var color = $('tr[id="color_img_tr_'+checkbox.val()+'"]');
		color.find('td').eq(0).html(Obj.val());
	}
}

function into_set(){
	
	<{foreach item=list key=num from=$firstvalue.d}>
	property_checked_<{$num}> = new Array();
	$('td[data_type="property_td_<{$num}>"]').find('input[type="checkbox"]:checked').each(function(){
		v = $(this).attr('data_type');
		i = $(this).val();
	
		property_checked_<{$num}>[property_checked_<{$num}>.length] = [v,i];
	});
	property_checked[<{$num}>] = property_checked_<{$num}>;
	<{/foreach}>
}

function stock_set(){
	
	$('input[name="price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
	$('input[name="market_price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
	$('input[name="cost_price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
	$('input[name="amount"]').attr('readonly','readonly').css('background','#E7E7E7 none');
	$('input[name="code"]').attr('readonly','readonly').css('background','#E7E7E7 none');
	
	$('tbody[data_type="property_tbody"]').show();
	str = '<tr>';
		
	<{$abc}>
	
	if(str == '<tr>'){
		$('input[name="price"]').attr('readonly','').css('background','');
		$('input[name="market_price"]').attr('readonly','').css('background','');
		$('input[name="cost_price"]').attr('readonly','').css('background','');
		$('input[name="amount"]').attr('readonly','').css('background','');
		$('input[name="code"]').attr('readonly','').css('background','');
		$('tbody[data_type="property_tbody"]').hide();
	}
	
	var i=0;
	$('tbody[data_type="property_table"]')
		.empty()
		.html(str)
		.find('input[type="text"]').each(function(){
			s = $(this).attr('data_type');
			try{$(this).val(V[s])}catch(ex){$(this).val('')};
			if($(this).attr('data_type') == 'price' && $(this).val() == ''){
				$(this).val($('input[name="price"]').val());
			}
			if($(this).attr('data_type') == 'market_price' && $(this).val() == ''){
				$(this).val($('input[name="market_price"]').val());
			}
			if($(this).attr('data_type') == 'cost_price' && $(this).val() == ''){
				$(this).val($('input[name="cost_price"]').val());
			}
			if($(this).attr('data_type') == 'sku' && $(this).val() == ''){
				$(this).val(parseInt($('input[name="code"]').val())+(i));
				i++;
			}
		});
	count_stock();
	count_price('price');
	count_price('market_price');
	count_price('cost_price');
	code();
}

function count_stock(){
	var stock = 0;
	$('input[data_type="stock"]').each(function(){
		if($(this).val() != ''){
			stock += parseInt($(this).val());
		}
	});
	$('input[name="amount"]').val(stock);
}

function code(){
	var max = 0.01;
	var min = 10000000;
	$('input[data_type="sku"]').each(function(){
		if($(this).val() != ''){
			max = Math.max(max,$(this).val());
			min = Math.min(min,$(this).val());
		}
	});
	if($('input[name="code"]').val()!='0' && !$('input[name="code"]').val())
	{
		if(min != 10000000){
			$('input[name="code"]').val(min);
		}
	}
}

function count_price(obj){
	var max = 0.01;
	var min = 10000000;
	$('input[data_type="'+obj+'"]').each(function(){
		if($(this).val() != ''){
			max = Math.max(max,$(this).val());
			min = Math.min(min,$(this).val());
		}
	});
	if(min != 10000000){
		$('input[name="'+obj+'"]').val(min.toFixed(2));
	}
}

function pic_show(Obj){
	var V = $('#color').find('input[type="checkbox"]:checked');
	if(V.length == 0){	
		$('table[data_type="color_img"]').hide();
	}else{
		$('table[data_type="color_img"]').show();
	}
	var S = $('tr[id="color_img_tr_'+Obj.val()+'"]');
	if(S.css('display') == 'none'){
		S.show();
	}else{
		S.hide();
	}
}

$(function(){
	var E_SP = new Array();
	var E_SPV = new Array();
	
	<{foreach item=list from=$de.porperty}>
		<{foreach item=slist from=$list.setmeal}>
			<{foreach item=val key=num from=$slist}>
				E_SP[<{$num}>] = '<{$val}>';
			<{/foreach}>
			E_SPV['i_<{$list.property_value_id}>|price'] = '<{$list.price}>';
			E_SPV['i_<{$list.property_value_id}>|market_price'] = '<{$list.market_price}>';
			E_SPV['i_<{$list.property_value_id}>|cost_price'] = '<{$list.cost_price}>';
			E_SPV['i_<{$list.property_value_id}>|stock'] = '<{$list.stock}>';
			E_SPV['i_<{$list.property_value_id}>|sku'] = '<{$list.sku}>';
		<{/foreach}>	
	<{/foreach}>
	
	V = E_SPV;
	
	$('.firstvalue').find('input[type="checkbox"]').each(function(){
		$('input[name="price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
		$('input[name="market_price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
		$('input[name="cost_price"]').attr('readonly','readonly').css('background','#E7E7E7 none');
		$('input[name="amount"]').attr('readonly','readonly').css('background','#E7E7E7 none');
		$('input[name="code"]').attr('readonly','readonly').css('background','#E7E7E7 none');
		$('tbody[data_type="property_tbody"]').show();
	});

	into_set();

	str = '<tr>';
	
	<{$abc}>
	
	if(str == '<tr>'){
		$('input[name="price"]').attr('readonly','').css('background','');
		$('input[name="market_price"]').attr('readonly','').css('background','');
		$('input[name="cost_price"]').attr('readonly','').css('background','');
		$('input[name="amount"]').attr('readonly','').css('background','');
		$('input[name="code"]').attr('readonly','').css('background','');
		$('tbody[data_type="property_tbody"]').hide();
	}
	$('tbody[data_type="property_table"]')
		.empty()
		.html(str)
		.find('input[type="text"]').each(function(){
			s = $(this).attr('data_value');
			try{$(this).val(E_SPV[s])}catch(ex){$(this).val('')};
		});
	
	$('#color').find('input[type="checkbox"]:checked').each(function(){
		pic_show($(this));
	});
});
</script>